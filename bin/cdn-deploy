#!/usr/bin/env node

const program = require('commander')
const chalk = require('chalk')
const fs = require('fs')
const path = require('path')
const shell = require('shelljs')
const {
  createFile,
  hasFile
} = require('../utils/file')

program
  .version('1.0.2')

program
  .command('init')
  .description(chalk.gray('Init'))
  .action(() => {
    hasFile({
      to: `./deploy-config`
    }).then(() => {
      fs.readdirSync(path.resolve(__dirname, '../templates')).forEach(file => {
        createFile({
          from: path.resolve(__dirname, `../templates/${file}`),
          to: `./deploy-config/${file}`,
          replaceKey: 'aliyun'
        })
      })
    }).catch(() => console.log('Cancelled'))
  })

program
  .command('deploy')
  .description(chalk.gray('Deploy project'))
  .action(() => {
    shell.exec(`node ${path.resolve(__dirname, '../index.js')}`)
  })

program.on('--help', () => {
    console.log()
    console.log('  Examples:')
    console.log()
    console.log('    $ cdn-deploy --help')
    console.log('    $ cdn-deploy -h')
  })

program.parse(process.argv)
