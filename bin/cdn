#!/usr/bin/env node

const program = require('commander')
const kleur = require('kleur')
const path = require('path')

const {
  createFile,
  canCreateFile
} = require('../lib/utils/file')
const deploy =  require('../src')

program
  .version('3.0.0')

program
  .command('init')
  .description(kleur.gray('初始化'))
  .action(() => {
    canCreateFile({
      to: './deploy.config.js'
    }).then(() => {
      createFile({
        from: path.resolve(__dirname, '../templates/deploy.config.js'),
        to: './deploy.config.js',
      })
    }).catch(() => {
      console.log('deploy.config.js 文件已存在')
    })
  })

program
  .command('deploy <environment>')
  .description(kleur.gray('部署项目'))
  .action(environment => {
    deploy(environment)
  })

program.on('--help', () => {
  console.log()
  console.log('  例子:')
  console.log()
  console.log('    $ cdn init')
  console.log('    $ cdn deploy development')
})

program.parse(process.argv)
